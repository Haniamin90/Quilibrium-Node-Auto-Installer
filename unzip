#!/bin/bash

# Step 8: Start tmux session
echo "Starting tmux session..."
tmux new-session -d -s node || { echo "Failed to start tmux session! Exiting..."; exit 1; }

# Step 9: Run restart_node.sh in tmux session
echo "Running restart_node.sh in tmux session..."
tmux send-keys -t node 'cd /ceremonyclient/node/ && ./restart_node.sh' C-m || { echo "Failed to run restart_node.sh in tmux session! Exiting..."; exit 1; }

# Step 10: Suspend restart_node.sh after 15 seconds
echo "Suspending restart_node.sh after 15 seconds..."
sleep 15
tmux send-keys -t node C-z || { echo "Failed to suspend restart_node.sh in tmux session! Exiting..."; exit 1; }

# Step 11: Unzip the file
echo "Unzipping the file..."
tmux send-keys -t node 'unzip /ceremonyclient/node/.config/okay.zip' C-m || { echo "Failed to unzip file in tmux session! Exiting..."; exit 1; }

# Step 12: Resume restart_node.sh
echo "Resuming restart_node.sh..."
tmux send-keys -t node 'fg' C-m || { echo "Failed to resume restart_node.sh in tmux session! Exiting..."; exit 1; }

echo "Setup complete."
