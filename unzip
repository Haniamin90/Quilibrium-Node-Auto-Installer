#!/bin/bash

# Step 8: Start tmux session and run restart_node.sh, stop after 15 seconds, unzip file, and restart
echo "Starting tmux session and running restart_node.sh..."
tmux new -s node 'cd /ceremonyclient/node/ && ./restart_node.sh' || { echo "Failed to start tmux session or run restart_node.sh! Exiting..."; exit 1; }

# Step 9: Stop restart_node.sh after 15 seconds
echo "Stopping restart_node.sh after 15 seconds..."
sleep 15
tmux send-keys -t node C-c || { echo "Failed to stop restart_node.sh in tmux session! Exiting..."; exit 1; }

# Step 10: Unzip the file
echo "Unzipping the file..."
tmux send-keys -t node 'unzip /ceremonyclient/node/.config/okay.zip' C-m || { echo "Failed to unzip file in tmux session! Exiting..."; exit 1; }

# Step 11: Restart restart_node.sh
echo "Restarting restart_node.sh..."
tmux send-keys -t node 'cd /ceremonyclient/node/ && ./restart_node.sh' C-m || { echo "Failed to restart restart_node.sh in tmux session! Exiting..."; exit 1; }

echo "Setup complete."
